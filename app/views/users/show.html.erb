<div class="profile-header">
  <h1 class="profile-username">@<%= @user.username %></h1>

  <div class="profile-stats">
    <span><strong><%= @user.following.count %></strong> following</span>
    <span><strong><%= @user.followers.count %></strong> followers</span>
    <span><strong><%= @user.situations.count %></strong> situations</span>
  </div>

  <% if authenticated? && Current.user != @user %>
    <% if Current.user.following?(@user) %>
      <% follow = Current.user.active_follows.find_by(followed: @user) %>
      <%= button_to "Unfollow", follow_path(follow), method: :delete, class: "btn" %>
    <% else %>
      <%= button_to "Follow", follows_path(followed_id: @user.id), method: :post, class: "btn btn-primary" %>
    <% end %>
  <% end %>

  <% if @current_situation %>
    <div class="card" style="margin-top: 1rem; text-align: left;">
      <strong>Current Situation:</strong>
      <% if @current_situation.message.present? %>
        <p><%= @current_situation.message %></p>
      <% end %>
      <% if @current_situation.tags.any? %>
        <div class="situation-tags">
          <% @current_situation.tags.each do |tag| %>
            <span class="tag"><%= tag.name %></span>
          <% end %>
        </div>
      <% end %>
      <small style="color: var(--color-text-light);"><%= time_ago_in_words(@current_situation.created_at) %> ago</small>
    </div>
  <% end %>
</div>

<h2>Situation History</h2>
<% if @situations.any? %>
  <% @situations.each do |situation| %>
    <%= render partial: "situations/situation", locals: { situation: situation } %>
  <% end %>
<% else %>
  <div class="card">
    <p>No situations yet.</p>
  </div>
<% end %>
